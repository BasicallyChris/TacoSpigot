From 6190851f0f6b240e051cdda2c48abac3e22b3681 Mon Sep 17 00:00:00 2001
From: Vml11 <victorbcn98@gmail.com>
Date: Fri, 6 Apr 2018 02:40:26 +0200
Subject: [PATCH] Added-TNTDispenseEvent


diff --git a/src/main/java/net/minecraft/server/DispenserRegistry.java b/src/main/java/net/minecraft/server/DispenserRegistry.java
index cc7a1e31..bc46b3b0 100644
--- a/src/main/java/net/minecraft/server/DispenserRegistry.java
+++ b/src/main/java/net/minecraft/server/DispenserRegistry.java
@@ -4,10 +4,13 @@ import com.mojang.authlib.GameProfile;
 import java.io.PrintStream;
 import java.util.Random;
 import java.util.UUID;
+
+import me.torciv.fluxspigot.event.entity.TNTDispensedEvent;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 
 // CraftBukkit start
+import org.bukkit.craftbukkit.entity.CraftEntity;
 import org.bukkit.craftbukkit.inventory.CraftItemStack;
 import org.bukkit.event.block.BlockDispenseEvent;
 // CraftBukkit end
@@ -548,9 +551,16 @@ public class DispenserRegistry {
                 EntityTNTPrimed entitytntprimed = new EntityTNTPrimed(block.getLocation(), world, event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ(), (EntityLiving) null); // PaperSpigot
                 // CraftBukkit end
 
-                world.addEntity(entitytntprimed);
-                world.makeSound(entitytntprimed, "game.tnt.primed", 1.0F, 1.0F);
-                // --itemstack.count; // CraftBukkit - handled above
+                // FluxSpigot Entity spawned
+
+                TNTDispensedEvent tntDispensedEvent = new TNTDispensedEvent(CraftEntity.getEntity(entitytntprimed.getWorld().getServer(),entitytntprimed));
+                world.getServer().getPluginManager().callEvent(tntDispensedEvent);
+
+                if (!tntDispensedEvent.isCancelled()) {
+                    world.addEntity(entitytntprimed);
+                    world.makeSound(entitytntprimed, "game.tnt.primed", 1.0F, 1.0F);
+                    // --itemstack.count; // CraftBukkit - handled above
+                }
                 return itemstack;
             }
         });
-- 
2.13.0.windows.1

